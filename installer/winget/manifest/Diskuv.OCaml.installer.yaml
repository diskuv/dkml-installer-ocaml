# Created using wingetcreate 1.1.2.0
# yaml-language-server: $schema=https://aka.ms/winget-manifest.installer.1.2.0.schema.json
# Follow:
#   https://docs.microsoft.com/en-us/windows/package-manager/package/manifest?tabs=minschema%2Cversion-example#tips-and-best-practices
#   https://github.com/microsoft/winget-pkgs/tree/master/doc/manifest/schema/1.2.0#best-practices
# Reference: https://github.com/microsoft/winget-pkgs/blob/master/doc/manifest/schema/1.2.0/installer.md
PackageIdentifier: Diskuv.OCaml
PackageVersion: 1.0.1 # BUMP
# Scope: user
UpgradeBehavior: install
Commands:
  # PATH entry: <DiskuvOCamlHome>/bin
  # BUT ... already a [winget install opam] so do not register those commands!
  # - opam
  # - opam-installer
  # - opam-putenv

  # PATH entry: <DiskuvOCamlHome>/usr/bin
  # BUT ... max 16 entries in Commands:[] so took only the most commonly used
  - dune
  - ocaml
  - ocamlc
  - ocamldebug
  - ocamldoc
  - ocamlfind
  - ocamlformat
  - ocamllsp
  - ocamlopt
  - ocamlrun
  - ocp-indent
  - utop
  - with-dkml
Platform:
  - "Windows.Desktop"
# Minimum OS comes from https://github.com/diskuv/dkml-runtime-distribution/blob/ff7e6bcbf3dbdb37e64b20a57e2dea0fa9d27ed5/src/windows/Machine/Machine.psm1#L14:
# > $Windows10SdkVer = "18362"
MinimumOSVersion: 10.0.18362.0
InstallerType: exe
InstallModes:
  - silent
  - interactive
InstallerSwitches:
  Silent: --ci --quiet --color=never
  SilentWithProgress: --ci
  Interactive: --color=always
  InstallLocation: --prefix "<INSTALLPATH>"
ReleaseDate: 2022-09-05 # BUMP
# Dependencies:
  # ExternalDependencies:
  #   - Microsoft.VisualStudio.2019.BuildTools
  #   - Git.Git
  # PackageDependencies:
  #   # ---- Visual Studio Redistributable ----
  #   # > The Microsoft Visual C++ 2015-2022 Redistributable Package (x64) installs runtime components of Visual C++ Libraries required to run 64-bit applications developed with Visual C++ 2015, 2017, 2019 and 2022 on a computer that does not have Visual C++ 2015, 2017, 2019 and 2022 installed.
  #   # - PackageIdentifier: Microsoft.VC++2015-2022Redist-x64

  #   # ---- Visual Studio Build Tools ----
  #   # Minimum comes from https://github.com/diskuv/dkml-runtime-distribution/blob/ff7e6bcbf3dbdb37e64b20a57e2dea0fa9d27ed5/src/windows/Machine/Machine.psm1#L94-L105:
  #   # > $VcStudioVcToolsMajorVer = 16
  #   # > $VcStudioVcToolsMinorVer = 6
  #   - PackageIdentifier: Microsoft.VisualStudio.2019.BuildTools
  #     MinimumVersion: 16.6.0

  #   # ---- Git ----
  #   # Minimum comes from https://github.com/diskuv/dkml-component-ocamlcompiler/blob/66af047444345a012213980269faffdf8ea83fb0/assets/staging-files/win32/setup-userprofile.ps1#L602-605
  #   - PackageIdentifier: Git.Git
  #     MinimumVersion: 2.34.0
Installers:
  - Architecture: x64

    InstallerUrl: https://github.com/diskuv/dkml-installer-ocaml/releases/download/v1.0.1/setup-diskuv-ocaml-windows_x86_64-1.0.1.exe # BUMP
    InstallerType: exe
    InstallerSha256: 129641cb609b50feb3fefbec1c435d99c7908d7523a3683bed34b166594628ee # BUMP

ManifestType: "installer"
ManifestVersion: "1.1.0"
